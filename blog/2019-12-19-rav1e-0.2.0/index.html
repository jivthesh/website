<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=https://rustav.org/img/logo.svg><link rel=manifest href=https://rustav.org/manifest.json><meta name=theme-color content=#ffffff><link rel=stylesheet href=https://rustav.org/css/bootstrap-reboot.css><link rel=stylesheet href=https://rustav.org/css/bootstrap.css><link rel=stylesheet href=https://rustav.org/css/font-awesome.min.css><link rel=stylesheet href=https://rustav.org/css/rust-av.css><title>rav1e 0.2.0 - Winter Solstice - Rust AV</title></head><body><header class="navbar navbar-expand navbar-dark flex-column flex-md-row tk-navbar"><a class=navbar-brand href=https://rustav.org/><img src=https://rustav.org/img/logo.svg class=align-middle alt></a><div class="collapse navbar-collapse"><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://rustav.org/>Home</a></li><li class=nav-item><a class="nav-link  active" href=https://rustav.org/blog/2020-03-30-rav1e-and-av-metrics/>Blog</a></li><li class=nav-item><a class=nav-link href=https://rustav.org/community/>Community</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/rust-av target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 0 1 128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd" /></svg></a></li></ul></header><div class="container-fluid tk-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 tk-sidebar"><div class="tk-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=tk-title>rav1e 0.2.0 - Winter Solstice</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#tk-docs-nav aria-controls=tk-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="tk-links collapse" id=tk-docs-nav><div class="tk-toc-item active"><p class=tk-toc-link>Blog Posts</p><ul class="nav tk-sidenav"><li><a href=https://rustav.org/blog/2020-03-30-rav1e-and-av-metrics/>Integration of AV-Metrics into rav1e, the AV1 Encoder</a></li><li><a href=https://rustav.org/blog/2019-12-19-rav1e-0.2.0/ class=active>rav1e 0.2.0 - Winter Solstice</a></li><li><a href=https://rustav.org/blog/2019-11-29-rav1e-and-gains-on-arm-devices/>rav1e and gains on ARM Devices</a></li><li><a href=https://rustav.org/blog/2019-11-20-rav1e-0.1.0/>rav1e 0.1.0 - Made in Tokyo</a></li><li><a href=https://rustav.org/blog/2019-04-09-using-rav1e-from-your-code/>Using rav1e - from your own code</a></li><li><a href=https://rustav.org/blog/2018-02-18-rust-av-and-multimedia/>Rust-av: Rust and Multimedia</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-4 tk-toc"><div class=section-nav><nav id=TableOfContents><ul><li><ul><li><a href=#winter-solstice-saturnalia-yuletide><del>Winter Solstice</del> <del>Saturnalia</del> Yuletide</a></li><li><a href=#what-s-new>What&rsquo;s new</a><ul><li><a href=#new-in-the-command-line>New in the command line</a></li><li><a href=#building-features>Building features</a></li><li><a href=#more-performance>More performance</a></li></ul></li><li><a href=#future-plans>Future plans</a></li></ul></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-7 py-md-3 pl-md-3 tk-content tk-docs"><h1 class=tk-title>rav1e 0.2.0 - Winter Solstice</h1><p class=tk-date>Luca Barbato</p><p>Yesterday we made the second release of <a href=https://github.com/xiph/rav1e>rav1e</a>.</p><h2 id=winter-solstice-saturnalia-yuletide><del>Winter Solstice</del> <del>Saturnalia</del> Yuletide</h2><p>The second <a href=https://github.com/xiph/rav1e/releases/tag/v0.2.0>official release</a> of <a href=https://github.com/xiph/rav1e/>rav1e</a> was focused mainly on speed. Later I&rsquo;ll write down what we used and what, in my opinion, are the best practices when you have to optimize a codebase like this one.</p><h2 id=what-s-new>What&rsquo;s new</h2><p>Since we focused mainly on speed, there aren&rsquo;t many user-facing changes.</p><h3 id=new-in-the-command-line>New in the command line</h3><ul><li><code>--benchmark</code>: Since I started to use <a href=https://www.gnu.org/software/time/>gnu time</a> to get some coarse information, I decided to add a <a href=https://docs.rs/libc/0.2.66/libc/fn.getrusage.html>getrusage()</a> report directly in the cli. Currently it is unix-like only, if you like Windows a pull request to add the same feature is really welcome!</li><li><code>advanced --save-config</code> / <code>advanced --load-config</code>: The options depend on building with <code>--features=serialize</code>, they let you dump and restore the full encoder configuration, it is quite useful if you want to tweak settings.</li></ul><h3 id=building-features>Building features</h3><ul><li><code>tracing</code>: Enables <a href=https://github.com/AlexEne/rust_hawktracer>hawktracer</a> probes.</li><li><code>serialize</code>: Enables serde support, it is optional mainly because it would nearly double the build time. Suggestions on something smaller are welcome.</li></ul><h3 id=more-performance>More performance</h3><p><img src=https://thepracticaldev.s3.amazonaws.com/i/3oh7fq03k0qtl6kxix2w.png alt="Alt Text"></p><p>Speed was the focus on this release and we tried our best not to increase the resident set, nor the overall memory usage.</p><p><img src=https://thepracticaldev.s3.amazonaws.com/i/1j7udx7w2eo9a5q83y0x.png alt="Alt Text"></p><p>The memory fragmentation that was quite significant in 0.1.0</p><p><img src=https://thepracticaldev.s3.amazonaws.com/i/3n4nd728u1vedfujbnsi.png alt="Alt Text"></p><p>Had been addressed fairly well in 0.2.0 and probably we&rsquo;ll return to it in 0.4.0:</p><p><img src=https://thepracticaldev.s3.amazonaws.com/i/u28k35aeok7p2qzg335t.png alt="Alt Text"></p><p>We are still not using as much cpu and memory as possible and there are still large inefficiencies to address in the future, some of it will be solved by the <a href=https://github.com/rayon-rs/rayon/>rayon</a> developers, some are on us:</p><p><img src=https://thepracticaldev.s3.amazonaws.com/i/rjk8yfsk5vjhdb6tg1s4.png alt="Alt Text"></p><p>In the future the lookahead computation we have in <code>send_frame</code> will happen in a separate thread and it will not stall the rest of the encoding process this much.</p><h2 id=future-plans>Future plans</h2><p>The focus for <code>0.2.0</code> was speed and we got between 40% and 70% faster in about 40 days.</p><p>The focus for <code>0.3.0</code> will be quality, striving to keep the encoding speed as fast as it is if not faster, we&rsquo;ll see how it will go next year.</p><p>Thanks for reading!</p><div class=tk-next><b>Next up</b>: <a href=https://rustav.org/blog/2020-03-30-rav1e-and-av-metrics/>Integration of AV-Metrics into rav1e, the AV1 Encoder</a></div></main></div></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script><script src=https://rustav.org/js/bootstrap.min.js></script><script src=https://rustav.org/js/highlight.js></script><script>$(function(){$("pre code").each(function(i,block){if(block.className.indexOf('language-rust')>=0){var new_content='';var lines=block.textContent.split('\n');for(var i=0;i<lines.length;i++){if(lines[i].indexOf('# ')==0||lines[i]=='#'){continue}
new_content+=lines[i].trimRight()+'\n';}
block.textContent=new_content.replace(/\n\n\n/g,"\n\n").trimRight();}
hljs.highlightBlock(block);});});</script><script>$(document).ready(function(){let data;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;document.getElementById("repos").innerHTML=data.length;})});</script><script>$(document).ready(function(){let data;let stargazersCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{stargazersCount=stargazersCount+data.stargazers_count
document.getElementById("stars").innerHTML=stargazersCount})})})</script><script>$(document).ready(function(){let data;let forksCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{forksCount=forksCount+data.forks_count
document.getElementById("forks").innerHTML=forksCount})})})</script><script>$(document).ready(function(){let data;let openIssuesCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{openIssuesCount=openIssuesCount+data.open_issues_count
document.getElementById("openissues").innerHTML=openIssuesCount})})})</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({apiKey:'d7b5b785798fe748621bcaa8301a2201',indexName:'tokio',inputSelector:'#search-input',debug:false});</script></body></html>