<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=https://rustav.org/img/logo.svg><link rel=manifest href=https://rustav.org/manifest.json><meta name=theme-color content=#ffffff><link rel=stylesheet href=https://rustav.org/css/bootstrap-reboot.css><link rel=stylesheet href=https://rustav.org/css/bootstrap.css><link rel=stylesheet href=https://rustav.org/css/font-awesome.min.css><link rel=stylesheet href=https://rustav.org/css/rust-av.css><title>rav1e 0.1.0 - Made in Tokyo - Rust AV</title></head><body><header class="navbar navbar-expand navbar-dark flex-column flex-md-row tk-navbar"><a class=navbar-brand href=https://rustav.org/><img src=https://rustav.org/img/logo.svg class=align-middle alt></a><div class="collapse navbar-collapse"><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://rustav.org/>Home</a></li><li class=nav-item><a class="nav-link  active" href=https://rustav.org/blog/2020-03-30-rav1e-and-av-metrics/>Blog</a></li><li class=nav-item><a class=nav-link href=https://rustav.org/community/>Community</a></li></ul></div><ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex"><li class=nav-item><a class="nav-link p-2" href=https://github.com/rust-av target=_blank rel=noopener aria-label=GitHub><svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64.0.0 114.61.0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34.0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49.0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75.0.0 21.49-6.88 70.4 26.24a242.65 242.65.0 0 1 128.18.0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69.0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41.0 34.22-.31 61.83-.31 70.23.0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37.0 256 0z" fill="currentcolor" fill-rule="evenodd" /></svg></a></li></ul></header><div class="container-fluid tk-blog"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 tk-sidebar"><div class="tk-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center"><h1 class=tk-title>rav1e 0.1.0 - Made in Tokyo</h1><button class="btn btn-link" type=button data-toggle=collapse data-target=#tk-docs-nav aria-controls=tk-docs-nav aria-expanded=false aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/></svg></button></div><nav class="tk-links collapse" id=tk-docs-nav><div class="tk-toc-item active"><p class=tk-toc-link>Blog Posts</p><ul class="nav tk-sidenav"><li><a href=https://rustav.org/blog/2020-03-30-rav1e-and-av-metrics/>Integration of AV-Metrics into rav1e, the AV1 Encoder</a></li><li><a href=https://rustav.org/blog/2019-12-19-rav1e-0.2.0/>rav1e 0.2.0 - Winter Solstice</a></li><li><a href=https://rustav.org/blog/2019-11-29-rav1e-and-gains-on-arm-devices/>rav1e and gains on ARM Devices</a></li><li><a href=https://rustav.org/blog/2019-11-20-rav1e-0.1.0/ class=active>rav1e 0.1.0 - Made in Tokyo</a></li><li><a href=https://rustav.org/blog/2019-04-09-using-rav1e-from-your-code/>Using rav1e - from your own code</a></li><li><a href=https://rustav.org/blog/2018-02-18-rust-av-and-multimedia/>Rust-av: Rust and Multimedia</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-4 tk-toc"><div class=section-nav><nav id=TableOfContents><ul><li><ul><li><a href=#intro>Intro</a></li><li><a href=#made-in-tokyo>Made in Tokyo</a></li><li><a href=#what-is-inside>What is inside</a><ul><li><a href=#crav1e-is-no-more>crav1e is no more</a></li><li><a href=#new-api-features>New API features</a><ul><li><a href=#keyframe-placement>Keyframe placement</a></li><li><a href=#multipass-rate-control>Multipass rate control</a></li><li><a href=#config-validation>Config validation</a></li></ul></li><li><a href=#speed>Speed</a></li></ul></li><li><a href=#what-s-next>What&rsquo;s next</a></li></ul></li></ul></nav></div></div><main class="col-12 col-md-9 col-xl-7 py-md-3 pl-md-3 tk-content tk-docs"><h1 class=tk-title>rav1e 0.1.0 - Made in Tokyo</h1><p class=tk-date>Luca Barbato</p><h2 id=intro>Intro</h2><blockquote><p><a href=https://aomedia.org/av1-features/>AV1</a> is a modern video codec brought to you by an alliance of <a href=https://aomedia.org/membership/members/>many</a> different bigger and smaller players in the multimedia field.
I&rsquo;m part of the <a href=https://videolan.org>VideoLan</a> organization and I spent quite a bit of time on this codec lately.</p></blockquote><hr><blockquote><p><a href=https://github.com/xiph/rav1e/>rav1e</a>: The safest and fastest AV1 encoder, built by many volunteers and Mozilla/Xiph developers.
It is written in <a href=https://rustlang.org>rust</a> and strives to provide good speed, quality and stay maintainable.</p></blockquote><hr><h2 id=made-in-tokyo>Made in Tokyo</h2><p>The first <a href=https://github.com/xiph/rav1e/releases/tag/0.1.0>official release</a> of <a href=https://github.com/xiph/rav1e/>rav1e</a> happened during the <a href=https://www.videolan.org/videolan/events/vdd19/>Video Dev Days 2019</a> in Tokyo.
Since it was originally presented during <a href=https://www.videolan.org/videolan/events/vdd17/>Video Dev Days 2017</a> it felt the right thing to do.</p><h2 id=what-is-inside>What is inside</h2><p>Since <a href=https://rustav.org/blog/2019-04-09-using-rav1e-from-your-code/>last time</a> I blogged about it, there are few changes:</p><h3 id=crav1e-is-no-more>crav1e is no more</h3><p>The <code>C-API</code> now is part of rav1e itself and everything is built by <a href=https://crates.io/crates/cargo-c>cargo-c</a>.</p><pre><code class=language-sh>cargo install cargo-c
cargo cinstall --destdir=/tmp/staging
sudo cp /tmp/staging/* /
</code></pre><p>Thats&rsquo;s all you need to use <code>rav1e</code> from C.</p><h3 id=new-api-features>New API features</h3><h4 id=keyframe-placement>Keyframe placement</h4><p>The rust API now let you override the keyframe placement</p><pre><code class=language-rust>  let cfg = Config::default();
  let mut ctx: Context&lt;u8&gt; = cfg.new_context().unwrap();
  let f1 = ctx.new_frame();
  let f2 = f1.clone();
  let info = FrameParameters {
    frame_type_override: FrameTypeOverride::Key
};

  // Send the plain frame data
  ctx.send_frame(f1)?;
  // Send the data and the per-frame parameters
  // In this case the frame is forced to be a keyframe.
  ctx.send_frame((f2, info))?;
  // Flush the encoder, it is equivalent to a call to `flush()`
  ctx.send_frame(None)?;
</code></pre><h4 id=multipass-rate-control>Multipass rate control</h4><p>It is possible to use <code>Context::twopass_out()</code> to feed back the rate control information that <code>Context::twopass_in()</code> can produce.</p><p>The API is intentionally opaque to the point you deal with pre-serialized data and not structured information.</p><h4 id=config-validation>Config validation</h4><p>We added <code>Config::validate()</code> to make sure the settings are correct and return a detailed error (<code>InvalidConfig</code>) if that&rsquo;s not the case.</p><h3 id=speed>Speed</h3><p>We overall made it a lot faster:</p><pre><code>15:23 &lt; koda&gt; hey guys, did an encode with the new 0.1.0, 20 hours for 8 minutes, down from 32 hours using a two month old build
15:23 &lt; koda&gt; congrats (and thanks) for making these speed improvements
</code></pre><p>And we are still working to speed it up a lot. The current weekly snapshot is an additional 20-25% faster compared to 0.1.0.</p><p><strong>NOTE</strong>: <code>rav1e</code> is still resources conscious, so it will not use all the threads and memory available. This makes it good if you want to encode multiple videos in parallel, but we will work on adding additional parallelism so even the single-video scenario is covered better.</p><h2 id=what-s-next>What&rsquo;s next</h2><p>Ideally a <code>0.2.0</code> will appear the early December, it will contain many speed improvements, lots of bugfixes (in particular docs.rs will serve the documentation) and possibly a large boost in single-pass quality if what Tim and Guillaume are working on will land in time.</p><div class=tk-next><b>Next up</b>: <a href=https://rustav.org/blog/2019-11-29-rav1e-and-gains-on-arm-devices/>rav1e and gains on ARM Devices</a></div></main></div></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script><script src=https://rustav.org/js/bootstrap.min.js></script><script src=https://rustav.org/js/highlight.js></script><script>$(function(){$("pre code").each(function(i,block){if(block.className.indexOf('language-rust')>=0){var new_content='';var lines=block.textContent.split('\n');for(var i=0;i<lines.length;i++){if(lines[i].indexOf('# ')==0||lines[i]=='#'){continue}
new_content+=lines[i].trimRight()+'\n';}
block.textContent=new_content.replace(/\n\n\n/g,"\n\n").trimRight();}
hljs.highlightBlock(block);});});</script><script>$(document).ready(function(){let data;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;document.getElementById("repos").innerHTML=data.length;})});</script><script>$(document).ready(function(){let data;let stargazersCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{stargazersCount=stargazersCount+data.stargazers_count
document.getElementById("stars").innerHTML=stargazersCount})})})</script><script>$(document).ready(function(){let data;let forksCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{forksCount=forksCount+data.forks_count
document.getElementById("forks").innerHTML=forksCount})})})</script><script>$(document).ready(function(){let data;let openIssuesCount=0;fetch('https://api.github.com/orgs/rust-av/repos?type=all').then(function(res){return res.json();}).then(function(json){data=json;data.map((data)=>{openIssuesCount=openIssuesCount+data.open_issues_count
document.getElementById("openissues").innerHTML=openIssuesCount})})})</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({apiKey:'d7b5b785798fe748621bcaa8301a2201',indexName:'tokio',inputSelector:'#search-input',debug:false});</script></body></html>